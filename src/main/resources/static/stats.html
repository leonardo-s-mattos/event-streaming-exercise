<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Moving Average App - Sales Statistics by Category</title>
</head>
<body>
<div>
    <table id="statsTable" style="width:100%">
        <tr>
            <th>Category</th>
            <th>Average $</th>
            <th>Average Pts</th>
        </tr>
    </table>
</div>
<script type="application/javascript">
    function addRow(category, averagePrice, averagePoints) {
        const row = document.createElement("tr");
        const categoryColumn = document.createElement("td");
        const salesColumn = document.createElement("td");
        const pointsColumn = document.createElement("td");

        categoryColumn.innerHTML = category;
        salesColumn.innerHTML = averagePrice;
        pointsColumn.innerHTML = averagePoints;

        row.appendChild(categoryColumn);
        row.appendChild(salesColumn);
        row.appendChild(pointsColumn);

        document.getElementById("statsTable").appendChild(row);
    }

    if (!!window.EventSource) {
        const eventSource = new EventSource("/stats-stream");

        window.onbeforeunload = function(){

        };

        eventSource.onopen = function (e) {

        };
        eventSource.onmessage = function (e) {
            var event = JSON.parse(e.data);
            addRow(event.category, event.averagePrice, event.averagePoints);
        };
        eventSource.onerror = function (e) {

        };
    }
</script>
</body>
</html>